Bootstrap: docker
From: maladmin/jessie-dtiprep:latest

%setup
	echo "Installing runscript"
	cp dtiprep.py ${SINGULARITY_ROOTFS}/opt/dtiprep.py
	cp environment ${SINGULARITY_ROOTFS}/environment
	exit 0

%post
	echo "Making dtiprep.py runnable"
	chmod 755 /opt/dtiprep.py

	mkdir /input
	mkdir /output
	mkdir /meta
	exit 0

%runscript
	if [ -z $1 ]
		then
			echo "DTIPrep Container"
			echo "USAGE:"
			echo "singularity run <container> -B <nrrd_inputfolder>:/input -B <outputfolder>:/output -B<metafolder>:/meta <subject_id>"
			exit 1
	fi
	export LD_LIBRARY_PATH=/opt/Slicer-4.6.2-linux-amd64/lib/Slicer-4.6
	export LD_LIBRARY_PATH=/opt/Slicer-4.6.2-linux-amd64/lib/Teem-1.12.0:$LD_LIBRARY_PATH
	export LD_LIBRARY_PATH=/opt/Slicer-4.6.2-linux-amd64/lib/Python/lib:$LD_LIBRARY_PATH
	export LD_LIBRARY_PATH=/opt/25516-linux-amd64-SlicerDMRI-gitce15576-2016-10-26/lib:$LD_LIBRARY_PATH
	export LD_LIBRARY_PATH=/opt/25516-linux-amd64-SlicerDMRI-gitce15576-2016-10-26/lib/vtkDMRI:$LD_LIBRARY_PATH
	export LD_LIBRARY_PATH=/opt/25516-linux-amd64-SlicerDMRI-gitce15576-2016-10-26/lib/Slicer-4.6/cli-modules/:$LD_LIBRARY_PATH
	
	echo "Arguments received: $*"

	echo "Running DTIPrep"
	/opt/dtiprep.py "$1"
