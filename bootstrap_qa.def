Bootstrap: docker
From: maladmin/dtiprep-base:latest

%setup
	echo "Installing runscript"
	cp dtiprep.py ${SINGULARITY_ROOTFS}/opt/dtiprep.py
	exit 0

%post
	echo "Getting DTIPrep"
	cd /opt
	wget https://www.nitrc.org/frs/download.php/6630/DTIPrep1.2.4_linux64.tar.gz -O dtiprep.tar.gz
	tar -xf dtiprep.tar.gz
	rm dtiprep.tar.gz



	echo "Making dtiprep.py runnable"
	chmod 755 /opt/dtiprep.py

	mkdir /input
	mkdir /output

	exit 0

%runscript
	if [ -z $1 ]
		then
			echo "DTIPrep Container"
			echo "USAGE:"
			echo "singularity run <container> <subject_id>"
			exit 1
	fi
	echo "Arguments received: $*"

	echo "Setting path"
	PATH=/opt/DTIPrepPackage:$PATH

	echo "Running DTIPrep"
	/opt/dtiprep.py "$1"
